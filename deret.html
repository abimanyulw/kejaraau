<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Latihan Tes Deret Angka</title>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600;700&family=Yeseva+One&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #141818;
      --frame: #f9f9f9;
      --text: #f9f9f9;
      --muted: rgba(249,249,249,0.7);
      --accent: rgba(249,249,249,0.06);
      --glass: rgba(255,255,255,0.04);
      --success: #9be7a2;
      --danger: #ff8b94;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: 'Josefin Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:18px 12px;
    }

    .phone {
      width:420px; /* looks good on wide mobile screens in preview */
      max-width:100%;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.03);
    }

    header{
      padding:18px 18px 14px 18px;
      display:flex;
      align-items:center;
      gap:12px;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
    }
    .logo {
      width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:var(--glass);border:1px solid rgba(255,255,255,0.03);
      font-family: 'Yeseva One', serif;color:var(--frame);font-size:18px
    }
    h1{font-family:'Yeseva One', serif;margin:0;font-size:18px;color:var(--frame);}
    p.subtitle{margin:0;font-size:12px;color:var(--muted)}

    main{padding:18px;background:transparent;}

    .card{
      background: rgba(255,255,255,0.02);
      border-radius:14px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.03);
    }

    .question-box{min-height:140px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;text-align:center}
    .sequence{font-size:20px;letter-spacing:1px;color:var(--frame);font-weight:600}
    .hint{font-size:12px;color:var(--muted)}

    .answer-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:6px}
    .num-input{appearance:none;border:1px solid rgba(255,255,255,0.06);background:transparent;border-radius:10px;padding:10px 14px;font-size:16px;color:var(--text);min-width:120px;text-align:center}

    /* controls layout: ensure buttons align and fill the frame (stacked columns) */
    .controls{display:flex;gap:12px;justify-content:space-between;align-items:stretch;margin-top:12px;flex-wrap:nowrap}
    .controls > div{display:flex;flex-direction:column;gap:8px;width:48%}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:12px 14px;border-radius:10px;font-weight:600;color:var(--frame);font-size:14px;width:100%;flex:unset;text-align:center}
    .btn.primary{background:linear-gradient(90deg, rgba(249,249,249,0.06), rgba(249,249,249,0.03));}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,0.02)}

    .progress{height:8px;background:rgba(255,255,255,0.03);border-radius:8px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg, rgba(249,249,249,0.2), rgba(249,249,249,0.06));width:0%}

    .footer{padding:12px 18px;font-size:12px;color:var(--muted);text-align:center}

    /* overlay instructions */
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;background:linear-gradient(180deg, rgba(20,24,24,0.9), rgba(20,24,24,0.95));z-index:60}
    .overlay .panel{max-width:520px;width:100%;background:rgba(255,255,255,0.02);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04)}
    .overlay h2{font-family:'Yeseva One',serif;margin:0 0 8px 0}
    .small{font-size:13px;color:var(--muted);line-height:1.45}

    .result{display:grid;gap:12px}
    .result .row{display:flex;justify-content:space-between;align-items:center}

    /* rincian soal table */
    .detail-table{width:100%;border-collapse:collapse;margin-top:6px}
    .detail-table th, .detail-table td{padding:8px 6px;text-align:left;font-size:13px;border-bottom:1px solid rgba(255,255,255,0.03);color:var(--muted)}
    .detail-table th{color:var(--frame);font-weight:600;font-size:13px}

    /* responsive tweaks */
    @media (max-width:420px){
      .phone{border-radius:12px}
      .sequence{font-size:18px}
      .btn{min-width:90px;font-size:13px}
    }
  </style>
</head>
<body>
  <div class="phone" role="application">
    <header>
      <div class="logo">DA</div>
      <div>
        <h1>Latihan Tes Deret Angka</h1>
        <p class="subtitle">Tes Inteligensi Umum (TIU)</p>
      </div>
    </header>

    <main>
      <div class="card" id="app">
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div class="progress" aria-hidden><i id="prog"></i></div>
<br>
          <div class="question-box" id="questionBox">
            <div class="sequence" id="sequenceText">—</div>
            <div class="hint" id="hintText">Masukkan nilai angka selanjutnya.</div>
            <div class="answer-row">
              <input id="answerInput" class="num-input" inputmode="numeric" pattern="[0-9]*" placeholder="Tulis jawaban angka" />
            </div>

            <div class="controls" style="width:100%">
              <div>
                <button class="btn ghost" id="prevBtn">Sebelumnya</button>
                <button class="btn" id="skipBtn">Lewatkan</button>
              </div>
              <div>
<button class="btn ghost" id="nextBtn">Berikutnya</button>
                
                <button class="btn primary" id="submitBtn">Kirim Jawaban</button>
              </div>
            </div>
<br>
            <div style="width:100%;display:flex;justify-content:space-between;margin-top:6px">
              <div class="hint" id="qCount">Soal 0/0</div>
              <div class="hint" id="timer">Waktu: 00:00</div>
            </div>

          </div>

          <div id="endPanel" style="display:none" class="question-box">
            <div class="sequence">Hasil Latihan</div>
            <div class="hint">Berikut adalah hasil latihan yang telah dilakukan.</div>
            <div class="card result" id="resultSummary"></div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
              <button class="btn" id="retryBtn">Ulangi</button>
              <button class="btn primary" id="downloadBtn">Unduh Hasil (JSON)</button>
            </div>
          </div>

        </div>
      </div>
    </main>

    <div class="footer">Abimanyu 2025</div>
  </div>

  <!-- Overlay instructions only shown at start -->
  <div class="overlay" id="overlay">
    <div class="panel">
      <h2>Instruksi</h2>
      <p class="small">Tujuan tes deret angka adalah untuk mengukur kemampuan dalam menganalisis dan menyelesaikan suatu permasalahan yang disajikan dalam bentuk angka. Deret angka biasanya disajikan berupa operasi matematika sederhana, deret aritmetika, geometri, maupun kombinasi. Setelah itu kamu akan diminta mencari angka selanjutnya dari pola deret yang ada.
<br><br>
Masukkan angka yang menurutmu melanjutkan deret tersebut. Gunakan tombol <strong>Kirim Jawaban</strong> untuk menyelesaikan soal, <strong>Selanjutnya</strong> untuk lompat ke soal berikut tanpa mengirim jawaban, dan <strong>Lewatkan</strong> bila ingin menandai soal untuk ditinjau nanti.</p>
      <p class="small" style="margin-top:10px"></p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn" id="startBtn">Mulai Latihan</button>
      </div>
    </div>
  </div>

  <script>
    // --- Utilities ---
    function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
    function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

    // --- Sequence generator ---
    const generators = {
      arithmetic: ()=>{
        const start = randInt(-5,20);
        const diff = randInt(1,12) * (Math.random()<0.12?-1:1);
        const len = randInt(4,7);
        const seq = Array.from({length:len},(_,i)=>start + i*diff);
        return {seq,answer: start + len*diff, type:'Aritmetika', detail:`beda konstan ${diff}`};
      },
      geometric: ()=>{
        const start = randInt(1,6);
        const r = [2,3, -2, -3][randInt(0,3)];
        const len = randInt(3,6);
        const seq = Array.from({length:len},(_,i)=>start * Math.pow(r,i));
        return {seq,answer: start * Math.pow(r,len), type:'Geometri', detail:`rasio ${r}`};
      },
      alternating: ()=>{
        // two interleaved arithmetic sequences
        const a0 = randInt(1,10), d0 = randInt(1,6);
        const a1 = randInt(0,10), d1 = randInt(1,6);
        const len = randInt(6,8);
        let seq=[]; for(let i=0;i<len;i++) seq.push( (i%2===0)? a0 + (i/2|0)*d0 : a1 + ((i-1)/2|0)*d1 );
        // next depends on parity
        const next = (len%2===0)? a0 + (len/2|0)*d0 : a1 + ((len-1)/2|0)*d1;
        return {seq,answer: next, type:'Bergantian', detail:`dua sub-deret: ${a0}+n*${d0} dan ${a1}+n*${d1}`};
      },
      fibonacciLike: ()=>{
        const a = randInt(1,6), b=randInt(1,6);
        const len = randInt(5,7);
        let seq = [a,b]; for(let i=2;i<len;i++) seq.push(seq[i-1]+seq[i-2]);
        return {seq,answer: seq[len-1] + seq[len-2], type:'Fibonacci-Serupa', detail:`penjumlahan dua sebelumnya`};
      },
      squares: ()=>{
        const base = randInt(1,6);
        const len = randInt(4,6);
        let seq = Array.from({length:len},(_,i)=>(base+i)*(base+i));
        return {seq,answer:(base+len)*(base+len), type:'Kuadrat', detail:'bilangan kuadrat bertambah 1 pada basis'};
      },
      primes: ()=>{
        const primes = [2,3,5,7,11,13,17,19,23,29,31,37,41];
        const startIdx = randInt(0,6);
        const len = randInt(4,6);
        const seq = primes.slice(startIdx,startIdx+len);
        return {seq,answer:primes[startIdx+len],type:'Prima',detail:'bilangan prima berurutan'};
      },
      squaresDiff: ()=>{
        // sequence of differences increasing: triangular
        const len = randInt(5,7);
        let seq=[1]; for(let i=1;i<len;i++) seq.push(seq[i-1] + i + (Math.random()<0.2?randInt(0,2):0));
        // make them nicer
        seq = seq.map(n=>n* (Math.random()<0.1? -1:1));
        return {seq,answer: seq[seq.length-1] + len, type:'Segitiga/Kenaikan', detail:'selisih bertambah teratur'};
      },
      customPattern: ()=>{
        // combine operations: *2 then -1 then +3 repeating
        const ops = [ (x,i)=>x*2, (x,i)=>x-1, (x,i)=>x+3 ];
        const start = randInt(1,6);
        const len = randInt(6,8);
        let seq=[start]; for(let i=1;i<len;i++){ const op = ops[(i-1)%ops.length]; seq.push(op(seq[i-1],i)) }
        return {seq,answer: ops[(len-1)%ops.length](seq[seq.length-1],seq.length-1), type:'Transformatif', detail:'pola operasi berulang (*2, -1, +3)'};
      }
    };

    function buildPool(n=15){
      const keys = Object.keys(generators);
      let pool=[];
      for(let i=0;i<n;i++){
        const g = generators[keys[i % keys.length]];
        pool.push(g());
      }
      return shuffle(pool);
    }

    // --- App state ---
    let pool=[],cur=0,answers=[],startTime=null, perQuestionStart=null, times=[];

    // --- DOM ---
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');
    const sequenceText = document.getElementById('sequenceText');
    const hintText = document.getElementById('hintText');
    const answerInput = document.getElementById('answerInput');
    const submitBtn = document.getElementById('submitBtn');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const skipBtn = document.getElementById('skipBtn');
    const qCount = document.getElementById('qCount');
    const timerEl = document.getElementById('timer');
    const progEl = document.getElementById('prog');
    const endPanel = document.getElementById('endPanel');
    const questionBox = document.getElementById('questionBox');
    const resultSummary = document.getElementById('resultSummary');
    const retryBtn = document.getElementById('retryBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    // timer
    let timerInterval=null;
    function startTimer(){ startTime = Date.now(); perQuestionStart = Date.now(); timerInterval = setInterval(()=>{
      const s = Math.floor((Date.now()-startTime)/1000);
      const mm = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      timerEl.textContent = `Waktu: ${mm}:${ss}`;
    },300); }
    function stopTimer(){ clearInterval(timerInterval); timerInterval=null }

    function render(){
      const total = pool.length;
      qCount.textContent = `Soal ${cur+1}/${total}`;
      progEl.style.width = `${Math.round((cur/total)*100)}%`;
      if(cur<0) cur=0; if(cur>=total) cur=total-1;

      const item = pool[cur];
      sequenceText.textContent = item.seq.join(' , ')+ ' , ...';
      hintText.textContent = 'Masukkan angka selanjutnya.';
      answerInput.value = answers[cur] != null ? answers[cur] : '';
      answerInput.focus();

      // disable prev/next appropriately
      prevBtn.disabled = cur===0;
      nextBtn.disabled = cur===total-1;
    }

    function submitAnswer(){
      const raw = answerInput.value.trim();
      const num = raw === '' ? null : Number(raw);
      answers[cur] = num;
      const elapsed = Math.floor((Date.now()-perQuestionStart)/1000);
      times[cur] = elapsed;
      perQuestionStart = Date.now();
      // feedback briefly
      if(num === pool[cur].answer){
        hintText.textContent = 'Benar! Lanjutkan.';
      } else if(num === null){
        hintText.textContent = 'Jawaban kosong disimpan. Gunakan Lewatkan bila ingin menandai.';
      } else {
        hintText.textContent = `Tersimpan. (Jawaban benar: ${pool[cur].answer})`;
      }
    }

    function goTo(index){ cur = index; render(); }

    function finish(){
      stopTimer();
      questionBox.style.display='none';
      endPanel.style.display='flex';
      computeAnalysis();
    }

    function computeAnalysis(){
      const total = pool.length;
      let correct=0, skipped=0;
      let totalTime = 0, answeredCount=0;
      for(let i=0;i<total;i++){
        const a = answers[i];
        const ans = pool[i].answer;
        if(a === null || a === undefined){ skipped++; }
        else if(Number(a) === Number(ans)) correct++;
        if(a !== null && a !== undefined){ answeredCount++; totalTime += (times[i]||0); }
      }

      const accuracy = Math.round((correct/total)*100);
      const avgTime = answeredCount? (totalTime/answeredCount).toFixed(1) : '-';

      // Build readable analysis (simplified: no type breakdown, no recommendations)
      resultSummary.innerHTML = '';
      const summary = document.createElement('div'); summary.className='row';
      summary.innerHTML = `<div>Skor</div><div style="font-weight:700">${correct}/${total} (${accuracy}%)</div>`;
      resultSummary.appendChild(summary);

      const timeRow = document.createElement('div'); timeRow.className='row';
      timeRow.innerHTML = `<div>Waktu rata-rata per soal</div><div style="font-weight:700">${avgTime} s</div>`;
      resultSummary.appendChild(timeRow);

      const skippedRow = document.createElement('div'); skippedRow.className='row';
      skippedRow.innerHTML = `<div>Soal dilewatkan</div><div style="font-weight:700">${skipped}</div>`;
      resultSummary.appendChild(skippedRow);

      // full data download payload
      const payload = {timestamp: new Date().toISOString(), total, correct, skipped, accuracy, avgTimeSeconds: avgTime, items: pool.map((p,i)=>({seq:p.seq, expected:p.answer, yourAnswer:answers[i] ?? null, type:p.type, detail:p.detail, timeSec: times[i]||null})) };
      downloadBtn.onclick = ()=>{
        const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'hasil_deret_angka.json'; a.click(); URL.revokeObjectURL(url);
      };

      // show tidy detailed list as table
      const detailsContainer = document.createElement('div'); detailsContainer.style.marginTop='10px';
      const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = 'Rincian soal';
      detailsContainer.appendChild(title);

      const table = document.createElement('table'); table.className = 'detail-table';
      const thead = document.createElement('thead'); thead.innerHTML = `<tr><th style="width:8%">No</th><th style="width:48%">Deret</th><th style="width:22%">Jawabanmu</th><th style="width:22%">Jawaban benar</th></tr>`;
      table.appendChild(thead);
      const tbody = document.createElement('tbody');

      pool.forEach((p,i)=>{
        const tr = document.createElement('tr');
        const your = answers[i] ?? '—';
        const correctMark = Number(answers[i]) === Number(p.answer) ? '✓' : '✕';
        tr.innerHTML = `<td>${i+1}</td><td>${p.seq.join(', ')} ...</td><td>${your}</td><td>${p.answer} ${correctMark}</td>`;
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      detailsContainer.appendChild(table);
      resultSummary.appendChild(detailsContainer);

    }

    // --- events ---
    startBtn.addEventListener('click', ()=>{
      overlay.style.display='none';
      pool = buildPool(16);
      answers = Array(pool.length).fill(null);
      times = Array(pool.length).fill(null);
      cur = 0; render(); startTimer();
    });

    submitBtn.addEventListener('click', ()=>{ submitAnswer(); });
    nextBtn.addEventListener('click', ()=>{ if(cur < pool.length-1){ cur++; render(); } else finish(); });
    prevBtn.addEventListener('click', ()=>{ if(cur>0){ cur--; render(); } });
    skipBtn.addEventListener('click', ()=>{ answers[cur]=null; times[cur]=Math.floor((Date.now()-perQuestionStart)/1000); cur++; render(); });

    retryBtn.addEventListener('click', ()=>{ location.reload(); });

    // keyboard enter to submit
    answerInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); submitAnswer(); if(cur<pool.length-1) { cur++; render(); } else finish(); } });

    // double-tap mobile improvement: focus
    // ganti handler resize lama dengan yang ini — mencegah kedip-kedip keyboard di mobile
let lastVVHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;

window.addEventListener('resize', () => {
  const currentVVHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;

  // Jika tinggi berkurang => kemungkinan keyboard terbuka -> abaikan
  // Jika perubahan sangat kecil (<120px) => bisa jadi scroll/toolbar -> abaikan
  if (currentVVHeight < lastVVHeight || Math.abs(currentVVHeight - lastVVHeight) < 120) {
    lastVVHeight = currentVVHeight;
    return;
  }

  // Perubahan besar ke arah meningkat (mis. orientasi berubah) -> refocus hanya jika belum fokus
  if (document.activeElement !== answerInput) {
    answerInput.focus();
  }

  lastVVHeight = currentVVHeight;
});


    // safety: if user navigates away, stop timer
    window.addEventListener('pagehide', ()=>{ stopTimer(); });
  </script>
</body>
</html>
