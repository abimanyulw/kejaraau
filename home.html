<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>KEJAR AAU</title>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600;700&family=Yeseva+One&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #141818;
      --frame: #f9f9f9;
      --text: #f9f9f9;
      --muted: rgba(249,249,249,0.7);
      --accent: rgba(249,249,249,0.06);
      --glass: rgba(255,255,255,0.04);
      --success: #9be7a2;
      --danger: #ff8b94;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: 'Josefin Sans', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:18px 12px;
    }

    .phone {
      width:420px; /* looks good on wide mobile screens in preview */
      max-width:100%;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.03);
    }

    header{
      padding:18px 18px 14px 18px;
      display:flex;
      align-items:center;
      gap:12px;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
    }
    .logo {
      width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:var(--glass);border:1px solid rgba(255,255,255,0.03);
      font-family: 'Yeseva One', serif;color:var(--frame);font-size:18px
    }
    h1{font-family:'Yeseva One', serif;margin:0;font-size:18px;color:var(--frame);}
    p.subtitle{margin:0;font-size:12px;color:var(--muted)}

    main{padding:18px;background:transparent;}

    .card{
      background: rgba(255,255,255,0.02);
      border-radius:14px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.03);
      margin-bottom:12px;
    }

    .section-title{font-weight:700;font-size:14px;color:var(--frame);margin-bottom:8px}
    .section-sub{font-size:13px;color:var(--muted);margin-bottom:10px}

    .menu-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .menu-item{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:8px;min-height:86px;justify-content:center}
    .menu-item h3{margin:0;font-size:15px;color:var(--frame);font-weight:700}
    .menu-item p{margin:0;font-size:12px;color:var(--muted)}
    .menu-item a{display:inline-block;margin-top:8px;padding:8px 10px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.04);text-decoration:none;color:var(--frame);font-weight:600}

    .list{display:flex;flex-direction:column;gap:8px}
    .list .item{padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.03);display:flex;justify-content:space-between;align-items:center}
    .list .item .title{font-weight:600;color:var(--frame)}
    .list .item .meta{font-size:12px;color:var(--muted)}

    .footer{padding:12px 18px;font-size:12px;color:var(--muted);text-align:center}

    /* styles for daily question */
    .q-title{ font-weight:700; font-size:15px; margin-bottom:8px; color:var(--frame) }
    .q-body{ font-size:14px; color:var(--text); line-height:1.45; margin-bottom:10px }
    .opts{ display:flex; flex-direction:column; gap:8px; margin-top:6px }
    .opt-btn{ text-align:left; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.03); cursor:pointer; color:var(--text); font-weight:600 }
    .opt-btn.disabled{ opacity:0.6; cursor:not-allowed }
    .result { margin-top:10px; padding:10px; border-radius:8px; }
    .result.correct{ background: rgba(155,231,162,0.12); border:1px solid rgba(155,231,162,0.18); color:var(--success) }
    .result.wrong{ background: rgba(255,139,148,0.08); border:1px solid rgba(255,139,148,0.12); color:var(--danger) }
    .muted{ color:var(--muted); font-size:13px }

    @media (max-width:420px){
      .phone{border-radius:12px}
      .menu-item{min-height:74px}
    }
/* --- Compact option label (A., B., ...) --- */
.opt-btn {
  display: flex;
  align-items: center;
  gap: 8px;               /* jarak kecil antar label & teks opsi */
  white-space: normal;    /* membolehkan teks turun baris kalau panjang */
}

/* beri lebar tetap agar label tidak mendorong teks dengan spasi tak konsisten */
.opt-btn strong {
  display: inline-block;
  flex: 0 0 30px;        /* sesuaikan lebar label (A.) */
  text-align: left;
  margin: 0;             /* hilangkan margin bawaan */
  padding-right: 2px;
}

/* jika teks opsi menghasilkan <p> (karena fungsi textToHtmlKeepMath),
   pastikan paragraf di dalam tombol tidak memberi margin berlebih */
.opt-btn p { margin: 0; }

/* --- Letakkan pembahasan di bawah tombol (override inline style) --- */
#q-actions {
  display: flex !important;
  flex-direction: column !important;
  align-items: stretch !important;
  gap: 8px !important;
  margin-top: 10px !important;
}

/* buat tombol pembahasan tetap di atas area pembahasan */
#btn-show-pembahasan {
  align-self: flex-start;
}

/* sedikit jarak untuk area pembahasan */
#pembahasan-area { margin-top: 6px; }

/* penyesuaian responsif kecil */
@media (max-width:420px){
  .opt-btn { gap: 6px; }
  .opt-btn strong { flex: 0 0 26px; }
}

  </style>

  <!-- MathJax untuk render LaTeX -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div class="phone" role="application">
    <header>
      <div class="logo">KR</div>
      <div>
        <h1>Gas Kejar AAU</h1>
        <p class="subtitle">Semangat Bang!</p>
      </div>
    </header>

    <main>
   <!-- NEW: Hari Ini 1 Soal -->
      <div class="card" id="daily-card">
        <div class="section-title">1 Hari 1 Soal</div>
        <div class="section-sub">Soal untuk hari ini</div>

        <div id="daily-inner">
          <!-- konten akan diisi oleh JS -->
          <div class="muted">Memuat soal hari iniâ€¦</div>
        </div>

       
      </div>
      
      <!-- existing card: Latihan Dasar -->
      <div class="card">
        <div class="section-title">Latihan Dasar</div>
        <div class="section-sub">Pilih modul latihan untuk mulai berlatih.</div>
        <div class="menu-grid">
          <div class="menu-item">
            <div>
              <h3>1. Tes Koran</h3><br>
              <p> Tes ini menguji seberapa cepat dan akurat peserta dapat melakukan tugas-tugas kognitif yang melibatkan deretan angka atau huruf.</p>
            </div>
            <a href="koran.html" aria-label="Buka Tes Koran">Buka</a>
          </div>

          <div class="menu-item">
            <div>
              <h3>2. Tes Deret Angka</h3><br>
              <p>Tes ini bertujuan untuk mengukur kemampuan analisis, ketelitian, dan kecermatan dalam memecahkan masalah numerik. </p>
            </div>
            <a href="deret.html" aria-label="Buka Tes Deret Angka">Buka</a>
          </div>

          <div class="menu-item">
            <div>
              <h3>3. Kalkulator Jasmani</h3><br>
              <p>Kalkulator ini dibuat khusus sesuai standar untuk menghitung nilai skor latihan fisik calon peserta tes masuk TNI. </p>
            </div>
            <a href="kaljas.html" aria-label="Buka Tes Deret Angka">Buka</a>
          </div>

          <div class="menu-item">
            <div>
              <h3>4. Tes Kecermatan</h3><br>
              <p>Tes ini dirancang untuk mengukur kemampuan seseorang dalam bekerja dengan cepat, akurat, dan konsisten dalam menghadapi informasi yang kompleks seperti angka, huruf, dan simbol</p>
            </div>
            <a href="cermat.html" aria-label="Buka Tes Deret Angka">Buka</a>
          </div>

          <div class="menu-item">
            <div>
              <h3>5. Tes Psikotes Teknikal</h3><br>
              <p>Tes ini dirancang untuk mengukur kemampuan logika, verbal, dan kualitatif analitis</p>
            </div>
            <a href="teknikal.html" aria-label="Buka Tes Deret Angka">Buka</a>
          </div>
        </div>
      </div>


      <!-- existing card: Materi-Materi -->
      <div class="card">
        <div class="section-title">Materi-Materi</div>
        <div class="section-sub">Bahan belajar dan penjelasan singkat.</div>
        <div class="list">
          <div class="item">
            <div>
              <div class="title">Psikotes</div>
              <div class="meta">Tes yang dilakukan untuk mengukur aspek individu secara psikis. </div>
            </div>
            <a href="https://drive.google.com/drive/folders/19qA5zX8DCm33GRyRQvQzVIFGTOMGl8xD" class="btn-link" aria-label="Buka Materi Psikotes">Buka</a>
          </div>

          <div class="item">
            <div>
              <div class="title">Akademik</div>
              <div class="meta">Bahasa Inggris, Bahasa Indonesia, Pengetahuan Alam, dan Pengetahuan Umum</div>
            </div>
            <a href="https://drive.google.com/drive/folders/19YIhYl3TZIp4KVON1gO_mdRPQDEqnxmu" class="btn-link" aria-label="Buka Materi Akademik">Buka</a>
          </div>

          <div class="item">
            <div>
              <div class="title">Ideologi dan Kebangsaan</div>
              <div class="meta">Pancasila dan UUD 1945</div>
            </div>
            <a href="https://drive.google.com/drive/folders/1GZm51XRZFI5LtcWzRd9FWaVElRu4SR1D" class="btn-link" aria-label="Buka Materi Akademik">Buka</a>
          </div>
        </div>
      </div>
    </main>

    <div class="footer">Abimanyu 2025</div>
  </div>

  <!-- Firebase + logic untuk Daily Question -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    // --- CONFIG: pakai config yang sama seperti admin ---
    const firebaseConfig = {
      apiKey: "AIzaSyCpe4N09OKb3eI3s5cLzPS9Cczbg9F-XQc",
      authDomain: "arise-63f67.firebaseapp.com",
      databaseURL: "https://arise-63f67-default-rtdb.firebaseio.com",
      projectId: "arise-63f67",
      storageBucket: "arise-63f67.firebasestorage.app",
      messagingSenderId: "847026490456",
      appId: "1:847026490456:web:db415425da44af80918e2d",
      measurementId: "G-KZ51MRKD3L"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // helper: escape + convert teks (preserve $$...$$ and \( ... \))
    function escapeHtml(s=''){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function textToHtmlKeepMath(raw=''){
      if (!raw) return '';
      // protect display $$ ... $$
      const parts = raw.split('$$');
      return parts.map((part, idx) => {
        if (idx % 2 === 1) return `$$${part}$$`;
        // outside $$: allow inline \(..\) by keeping backslashes, escape rest
        let esc = escapeHtml(part);
        esc = esc.replaceAll('\\(','\\(').replaceAll('\\)','\\)');
        const paras = esc.split(/\r?\n\r?\n/).map(p => p.replace(/\r?\n/g,'<br>'));
        return paras.map(p => `<p>${p}</p>`).join('');
      }).join('');
    }

    // render math
    async function renderMath(){
      if (window.MathJax && MathJax.typesetPromise){
        try { await MathJax.typesetPromise(); } catch(e){ console.warn(e); }
      }
    }

    // utilities for date keys
    function todayKey(){ // YYYY-MM-DD
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }
    function doneKey(){ return 'qz_done_' + todayKey(); }

    // main: load questions and pick today's
    async function loadDailyQuestion(){
      const container = document.getElementById('daily-inner');
      container.innerHTML = `<div class="muted">Memuat soal hari iniâ€¦</div>`;

      try {
        const snap = await get(ref(db, 'questions'));
        if (!snap.exists()){
          container.innerHTML = `<div class="muted">Belum ada soal di database. Tunggu admin menginput soal.</div>`;
          return;
        }

        // build array of questions (only published if you use status)
        const arr = [];
        snap.forEach(ch => {
          const val = ch.val(); val._id = ch.key;
          // optional: only include published
          if (!val.status || val.status === 'published') arr.push(val);
        });

        if (arr.length === 0){
          container.innerHTML = `<div class="muted">Tidak ada soal yang dipublikasikan.</div>`;
          return;
        }

       // pilih soal secara acak
let q = arr[Math.floor(Math.random() * arr.length)];

// jika user sudah menjawab hari ini, tunjukkan kembali soal yang sama (jika tersedia)
// supaya jawaban yang tersimpan di localStorage tetap relevan dengan soal yang ditampilkan
const done = localStorage.getItem(doneKey());
if (done) {
  try {
    const doneObj = JSON.parse(done);
    if (doneObj && doneObj.id) {
      const prev = arr.find(item => item._id === doneObj.id);
      if (prev) q = prev;
    }
  } catch (e) {
    // kalau parse error, abaikan dan tetap gunakan soal acak
    console.warn('Error parsing done flag', e);
  }
}

renderQuestionInContainer(q, container);

      } catch(err){
        console.error(err);
        container.innerHTML = `<div class="muted">Gagal memuat soal (periksa koneksi atau konfigurasi Firebase).</div>`;
      }
    }

    // render question UI
    function renderQuestionInContainer(q, container){
      const done = localStorage.getItem(doneKey());
      const answered = done ? JSON.parse(done) : null;

      // build HTML
      const html = `
       
        <div id="q-body" class="q-body">${textToHtmlKeepMath(q.soal || '')}</div>
        <div id="q-opts" class="opts">
          ${ (q.opsi || []).map((o,i)=> `<button data-idx="${i}" class="opt-btn" id="opt-${i}"><strong>${String.fromCharCode(65+i)}.</strong> ${textToHtmlKeepMath(o||'')}</button>`).join('') }
        </div>

        <div id="q-feedback"></div>

        <div id="q-actions" style="margin-top:10px; display:flex; gap:8px; align-items:center">
          <button id="btn-show-pembahasan" style="padding:8px 10px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:var(--frame);cursor:pointer">Tampilkan Pembahasan</button>
          <div id="pembahasan-area" style="flex:1"></div>
        </div>
      `;
      container.innerHTML = html;

      // disable inputs if already done
      if (answered){
        // mark selected and show result
        const sel = answered.selected;
        const correct = answered.correct;
        disableOptionsAndShowResult(sel, correct, q);
        // show pembahasan button enabled
        document.getElementById('btn-show-pembahasan').addEventListener('click', ()=> {
          showPembahasan(q);
        });
        return;
      }

      // otherwise attach click handlers
      const optsEl = container.querySelectorAll('.opt-btn');
      optsEl.forEach(btn=>{
        btn.addEventListener('click', ()=> {
          const idx = Number(btn.getAttribute('data-idx'));
          handleAnswer(q, idx);
        });
      });

      // pembahasan button: hidden until answer or allow viewing? We keep it disabled until answer
      const pbBtn = document.getElementById('btn-show-pembahasan');
      pbBtn.disabled = true;
      pbBtn.style.opacity = 0.6;

      // initial math render
      renderMath();
    }

    // when user answers
    function handleAnswer(q, idx){
      const selectedLabel = String.fromCharCode(65+idx);
      const correct = ( (q.kunci||'').toUpperCase() === selectedLabel );
      // save to localStorage so user can't reattempt today
      const payload = {
        id: q._id || null,
        selected: selectedLabel,
        correct: !!correct,
        answeredAt: Date.now()
      };
      localStorage.setItem(doneKey(), JSON.stringify(payload));

      disableOptionsAndShowResult(selectedLabel, correct, q);
    }

    function disableOptionsAndShowResult(selectedLabel, correct, q){
      // disable buttons
      const btns = document.querySelectorAll('#q-opts .opt-btn');
      btns.forEach(b=>{
        b.classList.add('disabled');
        b.disabled = true;
        // highlight chosen
        if (b.textContent.trim().startsWith(selectedLabel + '.')) {
          b.style.borderColor = correct ? 'rgba(155,231,162,0.6)' : 'rgba(255,139,148,0.6)';
          b.style.background = correct ? 'rgba(155,231,162,0.06)' : 'rgba(255,139,148,0.04)';
        }
        // highlight correct answer
        if (b.textContent.trim().startsWith((q.kunci||'') + '.')) {
          b.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
        }
      });

      const fb = document.getElementById('q-feedback');
      fb.innerHTML = `<div class="result ${correct ? 'correct' : 'wrong'}">${ correct ? 'Benar! ðŸŽ‰' : 'Salah' } &nbsp; (Kunci: ${escapeHtml(q.kunci||'')})</div>`;

      // enable pembahasan button
      const pbBtn = document.getElementById('btn-show-pembahasan');
      pbBtn.disabled = false;
      pbBtn.style.opacity = 1;
      pbBtn.addEventListener('click', ()=> showPembahasan(q));

      // render math (in case feedback/pembahasan shows)
      renderMath();
    }

    function showPembahasan(q){
      const area = document.getElementById('pembahasan-area');
      area.innerHTML = textToHtmlKeepMath(q.pembahasan || '<div class="muted">Pembahasan belum tersedia.</div>');
      renderMath();
    }

   // reset button for testing (clears today's local flag and reloads) â€” safe if element removed
const resetBtn = document.getElementById('daily-reset');
if (resetBtn) {
  resetBtn.addEventListener('click', ()=>{
    if (!confirm('Reset local penyelesaian hari ini? (hanya untuk testing)')) return;
    localStorage.removeItem(doneKey());
    loadDailyQuestion();
  });
}


    // on load
    loadDailyQuestion();
  </script>
</body>
</html>

